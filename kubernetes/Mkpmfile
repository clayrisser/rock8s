include $(MKPM)/mkpm
include $(MKPM)/dotenv
include $(CURDIR)/variables.mk

TERRAFORM ?= terraform

.PHONY: format
format:
	@$(TERRAFORM) fmt --recursive

.PHONY: init
init:
	@. $(HOME)/yaps/scripts/proxmox-auth.sh && \
		$(TERRAFORM) init $(VARS) . && \
		sh $(HOME)/yaps/scripts/proxmox-deauth.sh

.PHONY: apply
apply: init
	@. $(HOME)/yaps/scripts/proxmox-auth.sh && \
		$(TERRAFORM) apply $(VARS) . && \
		sh $(HOME)/yaps/scripts/proxmox-deauth.sh

.PHONY: destroy
destroy: init
	@. $(HOME)/yaps/scripts/proxmox-auth.sh && \
		$(TERRAFORM) destroy $(VARS) . && \
		sh $(HOME)/yaps/scripts/proxmox-deauth.sh
